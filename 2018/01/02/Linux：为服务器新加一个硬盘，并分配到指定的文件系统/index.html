
<!DOCTYPE html>
<html lang="zh-Hans" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Linux：为服务器新加一个硬盘，并分配到指定的文件系统 - 「C」</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="C君, Nukc, Github,"> 
    <meta name="description" content="使用 df -h 查看目前磁盘空间和使用情况
12345678[nukc@localhost ~]# df -hFilesystem                    Size  Used Av,"> 
    <meta name="author" content="Nukc"> 
    <link rel="alternative" href="atom.xml" title="「C」" type="application/atom+xml"> 
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>

<body class="loading">
    <span id="config-title" style="display:none">「C」</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="http://nukc.github.io"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">Linux：为服务器新加一个硬盘，并分配到指定的文件系统</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Linux：为服务器新加一个硬盘，并分配到指定的文件系统</h1>
        <div class="stuff">
            <span>一月 02, 2018</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/disk/">disk</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/linux/">linux</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/mount/">mount</a></li></ul>


        </div>
        <div class="content markdown">
            <p>使用 <code>df -h</code> 查看目前磁盘空间和使用情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line"></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div></pre></td></tr></table></figure>
<p><code>/dev/mapper/VolGroup-lv_root</code> 已经使用了 85%，是时候扩展容量了，原来的硬盘是 1T 的，也已经分配完了，通过 <code>vgdisplay</code> 命令是可以进行查看是否还有可用空间的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># vgdisplay</span></div><div class="line"></div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               VolGroup</div><div class="line">  System ID</div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  9</div><div class="line">  VG Access             <span class="built_in">read</span>/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                3</div><div class="line">  Open LV               3</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               930.82 GiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              238291</div><div class="line">  Alloc PE / Size       238290 / 930.82 GiB</div><div class="line">  Free  PE / Size       1 / 4.00 MiB</div><div class="line">  VG UUID               OAINo1-Xamg-GhOD-byhH-IMDV-6JPE-W6K9aX</div></pre></td></tr></table></figure>
<p>Free 只有 4MB 了，不指望了… 后来，加了个 4T 的硬盘，机房那边说只负责加硬盘，说不会挂载那些，我 fff… 佛慈悲</p>
<a id="more"></a>
<p><code>fdisk -l</code> 列出所有安装的磁盘及分区信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># fdisk -l</span></div><div class="line"></div><div class="line">WARNING: GPT (GUID Partition Table) detected on <span class="string">'/dev/sda'</span>! The util fdisk doesn                 <span class="string">'t support GPT. Use GNU Parted.</span></div><div class="line"></div><div class="line"></div><div class="line">Disk /dev/sda: 4000.8 GB, 4000787030016 bytes</div><div class="line">255 heads, 63 sectors/track, 486401 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sda1               1      267350  2147483647+  ee  GPT</div><div class="line"></div><div class="line">WARNING: GPT (GUID Partition Table) detected on '/dev/sdb<span class="string">'! The util fdisk doesn                 '</span>t support GPT. Use GNU Parted.</div><div class="line"></div><div class="line"></div><div class="line">Disk /dev/sdb: 1000.2 GB, 1000204886016 bytes</div><div class="line">255 heads, 63 sectors/track, 121601 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</div><div class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sdb1               1      121602   976762583+  ee  GPT</div><div class="line">Partition 1 does not start on physical sector boundary.</div><div class="line"></div><div class="line">Disk /dev/mapper/VolGroup-lv_root: 969.6 GB, 969614032896 bytes</div><div class="line">255 heads, 63 sectors/track, 117882 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</div><div class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line"></div><div class="line">Disk /dev/mapper/VolGroup-lv_swap: 8371 MB, 8371830784 bytes</div><div class="line">255 heads, 63 sectors/track, 1017 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</div><div class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line"></div><div class="line">WARNING: GPT (GUID Partition Table) detected on <span class="string">'/dev/mapper/ddf1_44656c6c202020                 201000005b10281f38460f100c210e2867'</span>! The util fdisk doesn<span class="string">'t support GPT. Use GNU                  Parted.</span></div><div class="line"></div><div class="line"></div><div class="line">Disk /dev/mapper/ddf1_44656c6c202020201000005b10281f38460f100c210e2867: 4000.2 G                 B, 4000225165312 bytes</div><div class="line">255 heads, 63 sectors/track, 486333 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line">                                                             Device Boot      St                 art         End      Blocks   Id  System</div><div class="line">/dev/mapper/ddf1_44656c6c202020201000005b10281f38460f100c210e2867p1                                1      267350  2147483647+  ee  GPT</div><div class="line"></div><div class="line">Disk /dev/mapper/ddf1_44656c6c202020201000005b10281f38460f100c210e2867p1: 4000.2                  GB, 4000223068160 bytes</div><div class="line">255 heads, 63 sectors/track, 486332 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x00000000</div><div class="line"></div><div class="line"></div><div class="line">Disk /dev/mapper/VolGroup-lv_home: 21.5 GB, 21474836480 bytes</div><div class="line">255 heads, 63 sectors/track, 2610 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</div><div class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</div><div class="line">Disk identifier: 0x00000000</div></pre></td></tr></table></figure>
<p>接下是错误的过程，如果不想看，可以直接跳转到  <a href="#suggestions">正确的姿势</a> 。</p>
<p>看到 warning 了，<code>WARNING: GPT (GUID Partition Table) detected on &#39;/dev/sda&#39;! The util fdisk doesn                 &#39;t support GPT. Use GNU Parted.</code> 我可不是专业的，先 google,</p>
<p>搜索结果如下：</p>
<p>2 种分区表：<br>MBR 分区表：（MBR 含义：主引导记录）<br>所支持的最大卷：2T （T; terabytes,1TB=1024GB）<br>对分区的设限：最多 4 个主分区或 3 个主分区加一个扩展分区。</p>
<p>GPT 分区表：（GPT 含义：GUID 分区表）<br>支持最大卷：18EB，（E：exabytes,1EB=1024TB）<br>每个磁盘最多支持 128 个分区</p>
<p>如果要大于 2TB 的卷或分区就必须得用 GPT 分区表。</p>
<p>Linux 下 fdisk 工具不支持 GPT，得使用另一个 GNU 发布的强大分区工具 parted。fdisk 工具用的话，会有那个的警告信息。</p>
<p>根据我之前找到的资料，接下来就是使用 <code>parted</code> 进行硬盘分区。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># parted /dev/sda</span></div><div class="line"></div><div class="line">GNU Parted 2.1</div><div class="line">使用 /dev/sda</div><div class="line">Welcome to GNU Parted! Type <span class="string">'help'</span> to view a list of commands.</div><div class="line">	(parted) mklabel gpt  (用gpt格式可以将3TB弄在一个分区里) </div><div class="line">警告: The existing disk label on /dev/sda will be destroyed and all data on this</div><div class="line">disk will be lost. Do you want to <span class="built_in">continue</span>?</div><div class="line">是/Yes/否/No? y</div><div class="line">	(parted) unit TB  (设置单位为TB) </div><div class="line">	(parted) <span class="built_in">print</span> (显示设置的分区大小）</div><div class="line">Model: ATA ST4000NM0035-1V4 (scsi)</div><div class="line">Disk /dev/sda: 4.00TB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: gpt</div><div class="line"></div><div class="line">Number  Start  End  Size  File system  Name  标志</div><div class="line"></div><div class="line">	(parted) mkpart primary 0 4   (设置为一个主分区,大小为 4TB，开始是 0，结束是 4）</div><div class="line">	(parted) <span class="built_in">print</span>  (显示设置的分区大小）</div><div class="line">Model: ATA ST4000NM0035-1V4 (scsi)</div><div class="line">Disk /dev/sda: 4.00TB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: gpt</div><div class="line"></div><div class="line">Number  Start   End     Size    File system  Name     标志</div><div class="line"> 1      0.00TB  4.00TB  4.00TB  ext4         primary</div><div class="line"></div><div class="line">(parted) quit  (退出 parted 程序)  </div><div class="line">信息: You may need to update /etc/fstab</div></pre></td></tr></table></figure>
<p>接着格式化分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># mkfs.ext4 /dev/sda1</span></div><div class="line"></div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">/dev/sda1 is apparently <span class="keyword">in</span> use by the system; will not make a 文件系统 here!</div></pre></td></tr></table></figure>
<p>/dev/sda1 正在被使用，解决办法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># dmsetup status</span></div><div class="line">VolGroup-lv_swap: 0 16351232 linear</div><div class="line">VolGroup-lv_root: 0 104857600 linear</div><div class="line">VolGroup-lv_root: 104857600 1788919808 linear</div><div class="line">ddf1_44656c6c202020201000005b10281f38460f100c210e2867: 0 7812939776 linear</div><div class="line">ddf1_44656c6c202020201000005b10281f38460f100c210e2867p1: 0 7812935680 linear</div><div class="line">VolGroup-lv_home: 0 41943040 linear</div><div class="line">[nukc@localhost ~]<span class="comment"># dmsetup remove_all</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># mkfs.ext4 /dev/sda1</span></div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">文件系统标签=</div><div class="line">操作系统:Linux</div><div class="line">块大小=4096 (<span class="built_in">log</span>=2)</div><div class="line">分块大小=4096 (<span class="built_in">log</span>=2)</div><div class="line">Stride=0 blocks, Stripe width=0 blocks</div><div class="line">244195328 inodes, 976754176 blocks</div><div class="line">48837708 blocks (5.00%) reserved <span class="keyword">for</span> the super user</div><div class="line">第一个数据块=0</div><div class="line">Maximum filesystem blocks=4294967296</div><div class="line">29809 block groups</div><div class="line">32768 blocks per group, 32768 fragments per group</div><div class="line">8192 inodes per group</div><div class="line">Superblock backups stored on blocks:</div><div class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</div><div class="line">        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,</div><div class="line">        102400000, 214990848, 512000000, 550731776, 644972544</div><div class="line"></div><div class="line">正在写入inode表: 完成</div><div class="line">Creating journal (32768 blocks): 完成</div><div class="line">Writing superblocks and filesystem accounting information: mount /dev/sda1 /usr/                 <span class="built_in">local</span>/data</div><div class="line">完成</div><div class="line"></div><div class="line">This filesystem will be automatically checked every 29 mounts or</div><div class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</div></pre></td></tr></table></figure>
<p>然后我乖乖的进行了挂载 mount</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># mount /dev/sda1 /usr/local/data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">/dev/sda1                     3.6T  196M  3.4T   1% /usr/<span class="built_in">local</span>/data</div></pre></td></tr></table></figure>
<p>到了这里，我的想法就是把 /dev/sda1 的 size 减少，然后加到 /dev/mapper/VolGroup-lv_root 上。</p>
<p>以下就是实际操作的过程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># lvreduce -L 3.3T /dev/sda1</span></div><div class="line">  Path required <span class="keyword">for</span> Logical Volume <span class="string">"sda1"</span>.</div><div class="line">  Please provide a volume group name</div><div class="line">  Run `lvreduce --<span class="built_in">help</span><span class="string">' for more information.</span></div><div class="line">[nukc@localhost ~]# umount /dev/sda1</div><div class="line">[nukc@localhost ~]# lvreduce -L 3.3T /dev/sda1</div><div class="line">  Path required for Logical Volume "sda1".</div><div class="line">  Please provide a volume group name</div><div class="line">  Run `lvreduce --help' <span class="keyword">for</span> more information.</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># pvcreate /dev/sda1</span></div><div class="line">  Physical volume <span class="string">"/dev/sda1"</span> successfully created</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># vgcreate mygroup /dev/sda1</span></div><div class="line">  Volume group <span class="string">"mygroup"</span> successfully created</div><div class="line">[nukc@localhost ~]<span class="comment"># bgdisplay mygroup | grep "Total PE"</span></div><div class="line">-bash: bgdisplay: <span class="built_in">command</span> not found</div><div class="line">[nukc@localhost ~]<span class="comment"># vgdisplay mygroup | grep "Total PE"</span></div><div class="line">  Total PE              953861</div><div class="line">[nukc@localhost ~]<span class="comment"># lvcreate -l 953861 mygroup -n data</span></div><div class="line">  Logical volume <span class="string">"data"</span> created.</div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># mkfs.ext4 /dev/mygroup/data</span></div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">文件系统标签=</div><div class="line">操作系统:Linux</div><div class="line">块大小=4096 (<span class="built_in">log</span>=2)</div><div class="line">分块大小=4096 (<span class="built_in">log</span>=2)</div><div class="line">Stride=0 blocks, Stripe width=0 blocks</div><div class="line">244195328 inodes, 976753664 blocks</div><div class="line">48837683 blocks (5.00%) reserved <span class="keyword">for</span> the super user</div><div class="line">第一个数据块=0</div><div class="line">Maximum filesystem blocks=4294967296</div><div class="line">29809 block groups</div><div class="line">32768 blocks per group, 32768 fragments per group</div><div class="line">8192 inodes per group</div><div class="line">Superblock backups stored on blocks:</div><div class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</div><div class="line">        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,</div><div class="line">        102400000, 214990848, 512000000, 550731776, 644972544</div><div class="line"></div><div class="line">正在写入inode表: 完成</div><div class="line">Creating journal (32768 blocks): 完成</div><div class="line">Writing superblocks and filesystem accounting information:</div><div class="line">完成</div><div class="line"></div><div class="line">This filesystem will be automatically checked every 37 mounts or</div><div class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># mount -a</span></div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">/dev/mapper/mygroup-data      3.6T  196M  3.4T   1% /usr/<span class="built_in">local</span>/data</div></pre></td></tr></table></figure>
<p>又重新挂载了一次。。。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># umount /usr/local/data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/mygroup-data 10G</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">请先运行 <span class="string">'e2fsck -f /dev/mapper/mygroup-data'</span>.</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># e2fsck -f /dev/mapper/mygroup-data</span></div><div class="line">e2fsck 1.41.12 (17-May-2010)</div><div class="line">第一步: 检查inode,块,和大小</div><div class="line">第二步: 检查目录结构</div><div class="line">第3步: 检查目录连接性</div><div class="line">Pass 4: Checking reference counts</div><div class="line">第5步: 检查簇概要信息</div><div class="line">/dev/mapper/mygroup-data: 11/244195328 files (0.0% non-contiguous), 15377150/976                 753664 blocks</div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/mygroup-data 10G</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">Resizing the filesystem on /dev/mapper/mygroup-data to 2621440 (4k) blocks.</div><div class="line">Begin pass 2 (max = 32768)</div><div class="line">正在重定位块            XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">Begin pass 3 (max = 29809)</div><div class="line">正在扫描inode表          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">The filesystem on /dev/mapper/mygroup-data is now 2621440 blocks long.</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># mount /usr/local/data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">/dev/mapper/mygroup-data      9.9G  164M  9.2G   2% /usr/<span class="built_in">local</span>/data</div></pre></td></tr></table></figure>
<p>确实减到了 10G，但是接下来却又发生了点事情。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># lvreduce -L 3.5T /dev/mapper/mygroup-data</span></div><div class="line">  WARNING: Reducing active and open logical volume to 3.50 TiB.</div><div class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</div><div class="line">Do you really want to reduce mygroup/data? [y/n]: y</div><div class="line">  Size of logical volume mygroup/data changed from 3.64 TiB (953861 extents) to 3.50 TiB (917504 extents).</div><div class="line">  Logical volume data successfully resized.</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  712G  130G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">/dev/mapper/mygroup-data      9.9G  164M  9.2G   2% /usr/<span class="built_in">local</span>/data</div><div class="line">[nukc@localhost ~]<span class="comment"># vgdisplay</span></div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               VolGroup</div><div class="line">  System ID</div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  9</div><div class="line">  VG Access             <span class="built_in">read</span>/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                3</div><div class="line">  Open LV               3</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               930.82 GiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              238291</div><div class="line">  Alloc PE / Size       238290 / 930.82 GiB</div><div class="line">  Free  PE / Size       1 / 4.00 MiB</div><div class="line">  VG UUID               OAINo1-Xamg-GhOD-byhH-IMDV-6JPE-W6K9aX</div><div class="line"></div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               mygroup</div><div class="line">  System ID</div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  3</div><div class="line">  VG Access             <span class="built_in">read</span>/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                1</div><div class="line">  Open LV               1</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               3.64 TiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              953861</div><div class="line">  Alloc PE / Size       917504 / 3.50 TiB</div><div class="line">  Free  PE / Size       36357 / 142.02 GiB</div><div class="line">  VG UUID               72Tki3-3lO0-1c9D-bppy-zTlw-PM2c-QE2bZZ</div></pre></td></tr></table></figure>
<p><code>mygroup</code> 的 Free PE 只有 142.02 GB，出现问题了，<code>umount</code> 之后再试一次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># umount /dev/mapper/mygroup-data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/mygroup-data</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">请先运行 <span class="string">'e2fsck -f /dev/mapper/mygroup-data'</span>.</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># e2fsck -f /dev/mapper/mygroup-data</span></div><div class="line">e2fsck 1.41.12 (17-May-2010)</div><div class="line">第一步: 检查inode,块,和大小</div><div class="line">第二步: 检查目录结构</div><div class="line">第3步: 检查目录连接性</div><div class="line">Pass 4: Checking reference counts</div><div class="line">第5步: 检查簇概要信息</div><div class="line">/dev/mapper/mygroup-data: 11/655360 files (0.0% non-contiguous), 83119/2621440 blocks</div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/mygroup-data</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">Resizing the filesystem on /dev/mapper/mygroup-data to 939524096 (4k) blocks.</div><div class="line">Begin pass 1 (max = 28592)</div><div class="line">正在扩充inode表          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">The filesystem on /dev/mapper/mygroup-data is now 939524096 blocks long.</div><div class="line"></div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  713G  129G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># mount /dev/mapper/mygroup-data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  713G  129G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">/dev/mapper/mygroup-data      3.5T  197M  3.3T   1% /usr/<span class="built_in">local</span>/data</div><div class="line">[nukc@localhost ~]<span class="comment"># umount /usr/local/data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/mygroup-data 10G</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">请先运行 <span class="string">'e2fsck -f /dev/mapper/mygroup-data'</span>.</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># e2fsck -f /dev/mapper/mygroup-data</span></div><div class="line">e2fsck 1.41.12 (17-May-2010)</div><div class="line">第一步: 检查inode,块,和大小</div><div class="line">第二步: 检查目录结构</div><div class="line">第3步: 检查目录连接性</div><div class="line">Pass 4: Checking reference counts</div><div class="line">第5步: 检查簇概要信息</div><div class="line">/dev/mapper/mygroup-data: 11/234881024 files (0.0% non-contiguous), 14792732/939524096 blocks</div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/mygroup-data 10G</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">Resizing the filesystem on /dev/mapper/mygroup-data to 2621440 (4k) blocks.</div><div class="line">Begin pass 3 (max = 28672)</div><div class="line">正在扫描inode表          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">The filesystem on /dev/mapper/mygroup-data is now 2621440 blocks long.</div><div class="line"></div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># mount /usr/local/data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  886G  713G  129G  85% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">/dev/mapper/mygroup-data      9.9G  164M  9.2G   2% /usr/<span class="built_in">local</span>/data</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># lvreduce -L 10G /dev/mapper/mygroup-data</span></div><div class="line">  WARNING: Reducing active and open logical volume to 10.00 GiB.</div><div class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</div><div class="line">Do you really want to reduce mygroup/data? [y/n]: y</div><div class="line">  Size of logical volume mygroup/data changed from 3.50 TiB (917504 extents) to 10.00 GiB (2560 extents).</div><div class="line">  Logical volume data successfully resized.</div><div class="line">[nukc@localhost ~]<span class="comment"># vgdisplay</span></div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               VolGroup</div><div class="line">  System ID</div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  9</div><div class="line">  VG Access             <span class="built_in">read</span>/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                3</div><div class="line">  Open LV               3</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               930.82 GiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              238291</div><div class="line">  Alloc PE / Size       238290 / 930.82 GiB</div><div class="line">  Free  PE / Size       1 / 4.00 MiB</div><div class="line">  VG UUID               OAINo1-Xamg-GhOD-byhH-IMDV-6JPE-W6K9aX</div><div class="line"></div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               mygroup</div><div class="line">  System ID</div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        1</div><div class="line">  Metadata Sequence No  4</div><div class="line">  VG Access             <span class="built_in">read</span>/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                1</div><div class="line">  Open LV               1</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                1</div><div class="line">  Act PV                1</div><div class="line">  VG Size               3.64 TiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              953861</div><div class="line">  Alloc PE / Size       2560 / 10.00 GiB</div><div class="line">  Free  PE / Size       951301 / 3.63 TiB</div><div class="line">  VG UUID               72Tki3-3lO0-1c9D-bppy-zTlw-PM2c-QE2bZZ</div></pre></td></tr></table></figure>
<p>现在 Free PE 有 3.63TB 了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># lvextend -L +3.63TiB /dev/mapper/VolGroup-lv_root</span></div><div class="line">  Rounding size to boundary between physical extents: 3.63 TiB.</div><div class="line">  Insufficient free space: 951583 extents needed, but only 1 available</div></pre></td></tr></table></figure>
<p>卧槽，不行，说是只有 1 可用。。。然后想了下，可能是不同的 Volume group 不能这样分配。那就重新来过，删除之前创建的 <code>mygroup</code> 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># vgs</span></div><div class="line">  VG       <span class="comment">#PV #LV #SN Attr   VSize   VFree</span></div><div class="line">  VolGroup   1   3   0 wz--n- 930.82g 4.00m</div><div class="line">  mygroup    1   1   0 wz--n-   3.64t 3.63t</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># umount /usr/local/data</span></div><div class="line">[nukc@localhost ~]<span class="comment"># lvremove /dev/mapper/mygroup-data</span></div><div class="line">Do you really want to remove active logical volume data? [y/n]: y</div><div class="line">  Logical volume <span class="string">"data"</span> successfully removed</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># vgremove mygroup</span></div><div class="line">  Volume group <span class="string">"mygroup"</span> successfully removed</div><div class="line"></div><div class="line">[nukc@localhost ~]<span class="comment"># vgs</span></div><div class="line">  VG       <span class="comment">#PV #LV #SN Attr   VSize   VFree</span></div><div class="line">  VolGroup   1   3   0 wz--n- 930.82g 4.00m</div></pre></td></tr></table></figure>
<p>好了，已经删除了。</p>
<h4 id="正确姿势"><a href="#正确姿势" class="headerlink" title="正确姿势"></a><div id="right">正确姿势</div></h4><p>搞了那么多，之前都是不对。之前通过 <code>fdisk -l</code> 知道了有个 4T 的硬盘 <code>/dev/sda1</code> ，通过 <code>vgs</code>命令知道了 <code>VolGroup</code> 这个 Volume group 。然后就是直接把 <code>/dev/sda1</code> 直接拓展到 <code>VolGroup</code> 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># vgextend VolGroup /dev/sda1</span></div><div class="line">  Volume group <span class="string">"VolGroup"</span> successfully extended</div><div class="line">[nukc@localhost ~]<span class="comment"># vgs</span></div><div class="line">  VG       <span class="comment">#PV #LV #SN Attr   VSize VFree</span></div><div class="line">  VolGroup   2   3   0 wz--n- 4.55t 3.64t</div><div class="line">[nukc@localhost ~]<span class="comment"># vgdisplay</span></div><div class="line">  --- Volume group ---</div><div class="line">  VG Name               VolGroup</div><div class="line">  System ID</div><div class="line">  Format                lvm2</div><div class="line">  Metadata Areas        2</div><div class="line">  Metadata Sequence No  10</div><div class="line">  VG Access             <span class="built_in">read</span>/write</div><div class="line">  VG Status             resizable</div><div class="line">  MAX LV                0</div><div class="line">  Cur LV                3</div><div class="line">  Open LV               3</div><div class="line">  Max PV                0</div><div class="line">  Cur PV                2</div><div class="line">  Act PV                2</div><div class="line">  VG Size               4.55 TiB</div><div class="line">  PE Size               4.00 MiB</div><div class="line">  Total PE              1192152</div><div class="line">  Alloc PE / Size       238290 / 930.82 GiB</div><div class="line">  Free  PE / Size       953862 / 3.64 TiB</div><div class="line">  VG UUID               OAINo1-Xamg-GhOD-byhH-IMDV-6JPE-W6K9aX</div></pre></td></tr></table></figure>
<p>这次算是 OK 了，接下来就是把 Free 的空间加到 <code>/dev/mapper/VolGroup-lv_root</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># lvextend -L +3.64TiB /dev/mapper/VolGroup-lv_root</span></div><div class="line">  Rounding size to boundary between physical extents: 3.64 TiB.</div><div class="line">  Insufficient free space: 954205 extents needed, but only 953862 available</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div><div class="line">[nukc@localhost ~]<span class="comment"># lvextend -L +3.60TiB /dev/mapper/VolGroup-lv_root</span></div><div class="line">  Rounding size to boundary between physical extents: 3.60 TiB.</div><div class="line">  Size of logical volume VolGroup/lv_root changed from 903.02 GiB (231174 extents) to 4.48 TiB (1174893 extents).</div><div class="line">  Logical volume lv_root successfully resized.</div><div class="line">[nukc@localhost ~]<span class="comment"># resize2fs -p /dev/mapper/VolGroup-lv_root</span></div><div class="line">resize2fs 1.41.12 (17-May-2010)</div><div class="line">Filesystem at /dev/mapper/VolGroup-lv_root is mounted on /; on-line resizing required</div><div class="line">old desc_blocks = 57, new_desc_blocks = 287</div><div class="line">Performing an on-line resize of /dev/mapper/VolGroup-lv_root to 1203090432 (4k) blocks.</div></pre></td></tr></table></figure>
<p>最后就是等最后那个命令完成，要是突然中断了，只要再执行一次最后那个命令就好。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[nukc@localhost ~]<span class="comment"># df -h</span></div><div class="line">Filesystem                    Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/VolGroup-lv_root  4.5T  714G  3.5T  17% /</div><div class="line">tmpfs                         7.8G   72K  7.8G   1% /dev/shm</div><div class="line">/dev/sdb2                     485M   40M  421M   9% /boot</div><div class="line">/dev/sdb1                     200M  260K  200M   1% /boot/efi</div><div class="line">/dev/mapper/VolGroup-lv_home   20G  172M   19G   1% /home</div><div class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</div></pre></td></tr></table></figure>
            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/5146554.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/qq/001faIUs4M2zna.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102422989-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


</html>
